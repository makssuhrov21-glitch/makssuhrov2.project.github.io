<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å | Winner Znamyanka</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: #f5f5f5;
            color: #333;
        }

        .admin-header {
            background: linear-gradient(135deg, #ff6b35, #4a90e2);
            color: white;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .admin-header h1 {
            font-size: 24px;
        }

        .admin-header a {
            color: white;
            text-decoration: none;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 8px;
            transition: 0.3s;
        }

        .admin-header a:hover {
            background: rgba(255,255,255,0.3);
        }

        .admin-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .admin-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .admin-card h2 {
            margin-bottom: 20px;
            color: #ff6b35;
            font-size: 22px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #ff6b35;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
            font-size: 16px;
        }

        .btn:hover {
            background: #e54e1b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,107,53,0.3);
        }

        .btn-secondary {
            background: #4a90e2;
        }

        .btn-secondary:hover {
            background: #357abd;
        }

        .product-item {
            background: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .product-info h3 {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .product-info p {
            font-size: 14px;
            color: #666;
        }

        .product-price {
            font-weight: 700;
            color: #ff6b35;
        }

        .product-actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            margin: 0 5px;
            padding: 5px;
            transition: 0.3s;
        }

        .product-actions button:hover {
            transform: scale(1.2);
        }

        .edit-btn { color: #4a90e2; }
        .delete-btn { color: #ff4444; }

        .images-section {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 15px 0;
        }

        .image-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .image-item {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .specs-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <header class="admin-header">
        <h1>‚ö° –ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å | Winner Znamyanka</h1>
        <a href="index.html">‚Üê –ù–∞ —Å–∞–π—Ç</a>
    </header>

    <div class="admin-container">
        <!-- –§–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É -->
        <div class="admin-card">
            <h2>‚ûï –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π —Ç–æ–≤–∞—Ä</h2>
            <form id="productForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>ID —Ç–æ–≤–∞—Ä—É</label>
                        <input type="text" id="productId" placeholder="felicity-1" required>
                    </div>
                    <div class="form-group">
                        <label>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                        <select id="productCategory">
                            <option value="–°–≤—ñ—Ç–ª–æ">–°–≤—ñ—Ç–ª–æ</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>–ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                        <select id="productSubcategory">
                            <option value="–ê–ö–ë">üîã –ê–ö–ë</option>
                            <option value="–Ü–Ω–≤–µ—Ä—Ç–æ—Ä">‚ö° –Ü–Ω–≤–µ—Ä—Ç–æ—Ä</option>
                            <option value="–ì—ñ–±—Ä–∏–¥–Ω–∏–π">üîÑ –ì—ñ–±—Ä–∏–¥–Ω–∏–π</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>–¶—ñ–Ω–∞ (–≥—Ä–Ω)</label>
                        <input type="number" id="productPrice" placeholder="38800" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞ (—É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é)</label>
                    <input type="text" id="productNameUa" placeholder="Felicity ESS LPBF 24V 200Ah" required>
                </div>

                <div class="form-group">
                    <label>–û–ø–∏—Å (—É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é)</label>
                    <textarea id="productDescUa" rows="2" placeholder="–û–ø–∏—Å —Ç–æ–≤–∞—Ä—É..."></textarea>
                </div>

                <div class="images-section">
                    <label>üñºÔ∏è –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è (—à–ª—è—Ö–∏ –¥–æ —Ñ–∞–π–ª—ñ–≤)</label>
                    <div class="image-list" id="imageList">
                        <div class="image-item">
                            <span>images/</span>
                            <input type="text" id="image1" placeholder="photo1.jpg" style="width: 100px;">
                        </div>
                    </div>
                    <button type="button" class="btn btn-secondary" style="margin-top: 10px;" onclick="addImageField()">+ –î–æ–¥–∞—Ç–∏ —â–µ —Ñ–æ—Ç–æ</button>
                </div>

                <div class="form-group">
                    <label>üìä –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–∫–æ–∂–Ω–∞ –∑ –Ω–æ–≤–æ–≥–æ —Ä—è–¥–∫–∞, —Ñ–æ—Ä–º–∞—Ç: –ù–∞–∑–≤–∞: –ó–Ω–∞—á–µ–Ω–Ω—è)</label>
                    <textarea id="productSpecs" rows="4" placeholder="–¢–∏–ø –±–∞—Ç–∞—Ä–µ—ó: LiFePO4
–ù–∞–ø—Ä—É–≥–∞: 24V
–Ñ–º–Ω—ñ—Å—Ç—å: 200Ah"></textarea>
                </div>

                <button type="submit" class="btn" style="width: 100%;">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–æ–≤–∞—Ä</button>
            </form>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤ -->
        <div class="admin-card">
            <h2>üìã –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤</h2>
            <div id="productsList">
                <p style="text-align: center; color: #999; padding: 20px;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
            </div>
            
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button class="btn btn-secondary" onclick="exportProducts()" style="flex: 1;">üì§ –ï–∫—Å–ø–æ—Ä—Ç JSON</button>
                <button class="btn btn-secondary" onclick="importProducts()" style="flex: 1;">üì• –Ü–º–ø–æ—Ä—Ç JSON</button>
            </div>
            <input type="file" id="importFile" accept=".json" style="display: none;">
        </div>
    </div>

    <script>
        let products = [];

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤
        async function loadProducts() {
            try {
                const response = await fetch('data/products.json?t=' + Date.now());
                products = await response.json();
                renderProducts();
            } catch (e) {
                console.log('–§–∞–π–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, —Å—Ç–≤–æ—Ä—é—î–º–æ —Ç–µ—Å—Ç–æ–≤—ñ —Ç–æ–≤–∞—Ä–∏');
                products = [
                    {
                        id: "felicity-1",
                        category: "–°–≤—ñ—Ç–ª–æ",
                        subcategory: "–ê–ö–ë",
                        price: 38800,
                        currency: "–≥—Ä–Ω",
                        name_ua: "üîã Felicity ESS LPBF 24V 200Ah",
                        images: ["images/no-image.jpg"],
                        specs: {
                            ua: [
                                ["–¢–∏–ø –±–∞—Ç–∞—Ä–µ—ó", "LiFePO4"],
                                ["–ù–∞–ø—Ä—É–≥–∞", "24V"],
                                ["–Ñ–º–Ω—ñ—Å—Ç—å", "200Ah"]
                            ]
                        }
                    },
                    {
                        id: "must-1",
                        category: "–°–≤—ñ—Ç–ª–æ",
                        subcategory: "–Ü–Ω–≤–µ—Ä—Ç–æ—Ä",
                        price: 54000,
                        currency: "–≥—Ä–Ω",
                        name_ua: "‚ö° Must 3.2kW 24V –Ü–Ω–≤–µ—Ä—Ç–æ—Ä",
                        images: ["images/no-image.jpg"],
                        specs: {
                            ua: [
                                ["–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å", "3.2 –∫–í—Ç"],
                                ["–ù–∞–ø—Ä—É–≥–∞", "24V"],
                                ["–¢–∏–ø", "–Ü–Ω–≤–µ—Ä—Ç–æ—Ä"]
                            ]
                        }
                    }
                ];
                renderProducts();
            }
        }

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤
        function renderProducts() {
            const list = document.getElementById('productsList');
            if (products.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">–ù–µ–º–∞—î —Ç–æ–≤–∞—Ä—ñ–≤</p>';
                return;
            }

            list.innerHTML = products.map(p => `
                <div class="product-item">
                    <div class="product-info">
                        <h3>${p.name_ua}</h3>
                        <p>${p.category} ‚Ä¢ ${p.subcategory} ‚Ä¢ <span class="product-price">${p.price} ${p.currency}</span></p>
                    </div>
                    <div class="product-actions">
                        <button class="edit-btn" onclick="editProduct('${p.id}')">‚úèÔ∏è</button>
                        <button class="delete-btn" onclick="deleteProduct('${p.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        // –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // –ó–±–∏—Ä–∞—î–º–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
            const specsText = document.getElementById('productSpecs').value;
            const specs = specsText.split('\n')
                .filter(line => line.trim())
                .map(line => {
                    const parts = line.split(':');
                    return [parts[0].trim(), parts[1]?.trim() || ''];
                });

            // –ó–±–∏—Ä–∞—î–º–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
            const images = [];
            for (let i = 1; i <= 5; i++) {
                const img = document.getElementById(`image${i}`)?.value;
                if (img) images.push(`images/${img}`);
            }
            if (images.length === 0) images.push('images/no-image.jpg');

            const product = {
                id: document.getElementById('productId').value,
                category: document.getElementById('productCategory').value,
                subcategory: document.getElementById('productSubcategory').value,
                price: parseInt(document.getElementById('productPrice').value),
                currency: '–≥—Ä–Ω',
                name_ua: document.getElementById('productNameUa').value,
                description_ua: document.getElementById('productDescUa').value,
                images: images,
                specs: { ua: specs }
            };

            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –≤–∂–µ —Ç–∞–∫–∏–π ID
            const index = products.findIndex(p => p.id === product.id);
            if (index >= 0) {
                products[index] = product;
                showMessage('‚úÖ –¢–æ–≤–∞—Ä –æ–Ω–æ–≤–ª–µ–Ω–æ');
            } else {
                products.push(product);
                showMessage('‚úÖ –¢–æ–≤–∞—Ä –¥–æ–¥–∞–Ω–æ');
            }

            renderProducts();
            saveToFile();
            this.reset();
        });

        // –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
        window.deleteProduct = function(id) {
            if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ç–æ–≤–∞—Ä?')) {
                products = products.filter(p => p.id !== id);
                renderProducts();
                saveToFile();
                showMessage('üóëÔ∏è –¢–æ–≤–∞—Ä –≤–∏–¥–∞–ª–µ–Ω–æ');
            }
        };

        // –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
        window.editProduct = function(id) {
            const p = products.find(p => p.id === id);
            if (!p) return;

            document.getElementById('productId').value = p.id;
            document.getElementById('productCategory').value = p.category;
            document.getElementById('productSubcategory').value = p.subcategory;
            document.getElementById('productPrice').value = p.price;
            document.getElementById('productNameUa').value = p.name_ua;
            document.getElementById('productDescUa').value = p.description_ua || '';

            if (p.specs?.ua) {
                const specsText = p.specs.ua.map(s => s.join(': ')).join('\n');
                document.getElementById('productSpecs').value = specsText;
            }

            if (p.images) {
                p.images.forEach((img, i) => {
                    const imgInput = document.getElementById(`image${i+1}`);
                    if (imgInput) {
                        const fileName = img.replace('images/', '');
                        imgInput.value = fileName;
                    }
                });
            }

            showMessage('‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É');
        };

        // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ —Ñ–∞–π–ª
        function saveToFile() {
            localStorage.setItem('admin_products', JSON.stringify(products));
            
            // –ü–æ–∫–∞–∑—É—î–º–æ —è–∫ –∑–±–µ—Ä–µ–≥—Ç–∏
            showMessage('üíæ –¢–æ–≤–∞—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ localStorage. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ï–∫—Å–ø–æ—Ä—Ç JSON" –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É');
        }

        // –ï–∫—Å–ø–æ—Ä—Ç JSON
        window.exportProducts = function() {
            const dataStr = JSON.stringify(products, null, 2);
            const blob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'products.json';
            a.click();
            URL.revokeObjectURL(url);
            showMessage('üì• –§–∞–π–ª products.json –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ');
        };

        // –Ü–º–ø–æ—Ä—Ç JSON
        window.importProducts = function() {
            document.getElementById('importFile').click();
        };

        document.getElementById('importFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    products = JSON.parse(e.target.result);
                    renderProducts();
                    showMessage('‚úÖ –¢–æ–≤–∞—Ä–∏ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ');
                } catch (err) {
                    showMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ JSON', 'error');
                }
            };
            reader.readAsText(file);
        });

        // –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–æ–ª—è –¥–ª—è –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
        window.addImageField = function() {
            const list = document.getElementById('imageList');
            const count = list.children.length + 1;
            if (count > 5) {
                showMessage('‚ùå –ú–∞–∫—Å–∏–º—É–º 5 —Ñ–æ—Ç–æ', 'error');
                return;
            }
            const div = document.createElement('div');
            div.className = 'image-item';
            div.innerHTML = `
                <span>images/</span>
                <input type="text" id="image${count}" placeholder="photo${count}.jpg" style="width: 100px;">
                <button type="button" onclick="this.parentElement.remove()" style="background:none; border:none; cursor:pointer; color:#ff4444;">√ó</button>
            `;
            list.appendChild(div);
        };

        // –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è
        function showMessage(text, type = 'success') {
            const msg = document.createElement('div');
            msg.className = 'notification';
            msg.textContent = text;
            msg.style.background = type === 'success' ? '#4caf50' : '#ff4444';
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 3000);
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ç–æ–≤–∞—Ä–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
        loadProducts();
    </script>
</body>
</html>
